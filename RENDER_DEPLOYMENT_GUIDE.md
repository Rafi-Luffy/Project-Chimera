# Project Chimera - Render Deployment Guide

Complete guide to deploy Project Chimera (Frontend + Backend) on Render.

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Project Structure](#project-structure)
3. [Pre-Deployment Checklist](#pre-deployment-checklist)
4. [Deployment Steps](#deployment-steps)
5. [Environment Variables](#environment-variables)
6. [Post-Deployment](#post-deployment)
7. [Troubleshooting](#troubleshooting)
8. [Monitoring](#monitoring)

---

## Prerequisites

Before deploying, ensure you have:

- ✅ GitHub account with Project Chimera repository
- ✅ Render account (sign up at https://render.com)
- ✅ Google AI API key (for Gemini 2.0 Flash)
- ✅ All code committed and pushed to GitHub

---

## Project Structure

```
Project Chimera/
├── backend/
│   ├── main_agents.py          # FastAPI application
│   ├── auth.py                 # Authentication logic
│   ├── database.py             # SQLite database models
│   ├── agents/                 # Agent system
│   └── project_chimera.db      # SQLite database (auto-created)
├── frontend-react/
│   ├── src/                    # React TypeScript source
│   ├── dist/                   # Build output (created during deployment)
│   ├── package.json
│   └── vite.config.ts
├── scripts/
│   └── SB_publication_PMC.csv  # Publication data
├── requirements.txt            # Python dependencies
├── render.yaml                 # Render configuration
└── RENDER_DEPLOYMENT_GUIDE.md  # This file
```

---

## Pre-Deployment Checklist

### 1. Code Ready for Production

- [x] API URLs use environment variables
- [x] Frontend uses `import.meta.env.VITE_BACKEND_URL`
- [x] Backend CORS allows frontend domain
- [x] All dependencies listed in requirements.txt
- [x] SQLite database initialization on startup
- [x] JWT authentication configured

### 2. Files Updated

**App.tsx:**
```typescript
const API_URL = import.meta.env.VITE_BACKEND_URL || 'http://localhost:8000';
```

**Login.tsx:**
```typescript
const API_URL = import.meta.env.VITE_BACKEND_URL || 'http://localhost:8000';
```

**requirements.txt:**
- Added SQLAlchemy for database
- Added python-jose for JWT
- Added passlib for password hashing

### 3. Commit All Changes

```bash
cd "/Users/rafi/Downloads/Project Chimera"
git add -A
git commit -m "Prepare for Render deployment"
git push origin master
```

---

## Deployment Steps

### Step 1: Create Render Account

1. Go to https://render.com
2. Sign up with GitHub
3. Authorize Render to access your repositories

### Step 2: Connect GitHub Repository

1. Click "New +" → "Blueprint"
2. Select "Project Chimera" repository
3. Render will detect `render.yaml` automatically

### Step 3: Review Services

Render will create two services:

**Backend Service:**
- Name: `chimera-backend-api`
- Type: Web Service
- Environment: Python 3.11.9
- Build Command: `pip install --upgrade pip && pip install -r requirements.txt`
- Start Command: `cd backend && uvicorn main_agents:app --host 0.0.0.0 --port $PORT`

**Frontend Service:**
- Name: `chimera-frontend`
- Type: Static Site
- Build Command: `cd frontend-react && npm install && npm run build`
- Publish Directory: `frontend-react/dist`

### Step 4: Configure Environment Variables

**For Backend (`chimera-backend-api`):**

1. Go to backend service dashboard
2. Navigate to "Environment" tab
3. Add these variables:

| Key | Value | Notes |
|-----|-------|-------|
| `GOOGLE_API_KEY` | Your Google AI API key | Get from https://aistudio.google.com/apikey |
| `JWT_SECRET_KEY` | (Auto-generated by Render) | Keep this secret |
| `JWT_ALGORITHM` | `HS256` | Already set in render.yaml |
| `PYTHON_VERSION` | `3.11.9` | Already set in render.yaml |

**For Frontend (`chimera-frontend`):**

1. Go to frontend service dashboard
2. Navigate to "Environment" tab
3. Verify this variable:

| Key | Value | Notes |
|-----|-------|-------|
| `VITE_BACKEND_URL` | `https://chimera-backend-api.onrender.com` | Auto-set from render.yaml |

### Step 5: Deploy

1. Click "Apply" or "Create Blueprint Instance"
2. Render will:
   - Clone your repository
   - Install dependencies
   - Build both services
   - Deploy them

**Build Times:**
- Backend: 2-3 minutes
- Frontend: 3-5 minutes

---

## Environment Variables

### Required Variables

#### Backend

```bash
# Google AI API Key (REQUIRED)
GOOGLE_API_KEY=your_google_ai_api_key_here

# JWT Authentication (Auto-generated)
JWT_SECRET_KEY=auto_generated_by_render
JWT_ALGORITHM=HS256

# Python Version
PYTHON_VERSION=3.11.9
```

#### Frontend

```bash
# Backend API URL
VITE_BACKEND_URL=https://chimera-backend-api.onrender.com
```

### How to Get Google AI API Key

1. Go to https://aistudio.google.com/apikey
2. Click "Create API Key"
3. Copy the key
4. Add it to Render backend environment variables

---

## Post-Deployment

### Step 1: Verify Backend

1. Open: `https://chimera-backend-api.onrender.com/health`
2. You should see:
```json
{
  "status": "healthy",
  "orchestrator": "online",
  "agents": {
    "librarian": "ready",
    "cartographer": "ready",
    "analyst": "initializing",
    "communicator": "ready",
    "orchestrator": "ready"
  },
  "knowledge_base": "not_loaded"
}
```

### Step 2: Initialize Backend

```bash
curl -X POST https://chimera-backend-api.onrender.com/initialize
```

Expected response:
```json
{
  "status": "success",
  "message": "Knowledge base initialized successfully",
  "statistics": {
    "total_publications": 200,
    "unique_subjects": 14,
    "unique_stressors": 6
  }
}
```

### Step 3: Test Frontend

1. Open: `https://chimera-frontend.onrender.com`
2. You should see the Chimera login page
3. Click "Continue without login"
4. Test a query: "What are the effects of microgravity on plant growth?"

### Step 4: Test Authentication

1. Register a new account
2. Login with credentials
3. Verify JWT token is stored
4. Query should work with user preferences saved

---

## Troubleshooting

### Issue 1: Backend Build Fails

**Error:** `Could not find a version that satisfies the requirement`

**Solution:**
1. Check requirements.txt formatting
2. Ensure all package versions are compatible
3. Check Render build logs for specific package errors

### Issue 2: Frontend Shows "Failed to Fetch"

**Error:** Browser console shows CORS or network errors

**Solution:**
1. Verify `VITE_BACKEND_URL` is set correctly in frontend
2. Check backend CORS settings in `main_agents.py`:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # Change to specific domain in production
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```
3. Ensure backend service is running (check Render dashboard)

### Issue 3: Database Not Initialized

**Error:** `Knowledge base not initialized`

**Solution:**
1. Call `/initialize` endpoint:
```bash
curl -X POST https://chimera-backend-api.onrender.com/initialize
```
2. Check backend logs for CSV file loading errors
3. Verify `scripts/SB_publication_PMC.csv` exists in repository

### Issue 4: Render Service Won't Start

**Error:** Service keeps restarting

**Solution:**
1. Check Render logs: Dashboard → Service → Logs
2. Common issues:
   - Missing environment variables (GOOGLE_API_KEY)
   - Python version mismatch
   - Missing dependencies
3. Verify start command in render.yaml

### Issue 5: Frontend Environment Variables Not Applied

**Error:** Frontend still connects to localhost

**Solution:**
1. Rebuild frontend service
2. Clear browser cache (Cmd+Shift+R)
3. Check browser console for actual API_URL being used
4. Verify Vite build includes environment variables

---

## Monitoring

### Backend Monitoring

**Health Check:**
```bash
curl https://chimera-backend-api.onrender.com/health
```

**Stats:**
```bash
curl https://chimera-backend-api.onrender.com/stats
```

**Test Query:**
```bash
curl -X POST https://chimera-backend-api.onrender.com/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "What are the effects of microgravity?",
    "persona": "Research Scientist"
  }'
```

### Frontend Monitoring

1. Open browser DevTools (F12)
2. Check Console for errors
3. Check Network tab for API calls
4. Verify API calls go to Render backend, not localhost

### Render Dashboard

1. Go to https://dashboard.render.com
2. Monitor both services:
   - **Build time:** Should be < 5 minutes
   - **Memory usage:** Free tier has 512MB
   - **Response time:** Check logs for slow queries
   - **Errors:** Red alerts indicate service issues

---

## Performance Notes

### Free Tier Limitations

**Render Free Tier:**
- Services sleep after 15 minutes of inactivity
- First request after sleep takes 30-60 seconds (cold start)
- 512MB RAM per service
- 750 hours/month of runtime

**Recommendations:**
1. Backend initialization takes time (CSVfile loading)
2. Frontend is static so loads instantly
3. Consider paid tier for production use
4. Use caching to reduce backend load

### Optimization Tips

1. **Backend:**
   - SQLite database is lightweight and perfect for free tier
   - Publications cached in memory after initialization
   - Consider adding Redis cache for faster queries (paid tier)

2. **Frontend:**
   - Static site loads instantly
   - No server-side rendering needed
   - CDN distribution included with Render

---

## Deployment URLs

After successful deployment, you'll have:

- **Frontend:** `https://chimera-frontend.onrender.com`
- **Backend:** `https://chimera-backend-api.onrender.com`
- **API Docs:** `https://chimera-backend-api.onrender.com/docs`

---

## Security Checklist

- [ ] GOOGLE_API_KEY is kept secret (not in code)
- [ ] JWT_SECRET_KEY is auto-generated by Render
- [ ] CORS allows only frontend domain (change from "*" for production)
- [ ] Environment variables are not committed to GitHub
- [ ] Database passwords (if using PostgreSQL) are secure
- [ ] HTTPS is enforced (Render does this automatically)

---

## Next Steps

1. **Custom Domain:** Point your domain to Render services
2. **Monitoring:** Set up uptime monitoring (UptimeRobot, Pingdom)
3. **Logging:** Enable structured logging for better debugging
4. **Scaling:** Upgrade to paid tier for better performance
5. **CI/CD:** Auto-deploy on git push (enabled by default with Blueprint)

---

## Support

- **Render Docs:** https://render.com/docs
- **Project Issues:** https://github.com/Rafi-Luffy/Project-Chimera/issues
- **Render Community:** https://community.render.com

---

**Last Updated:** October 5, 2025  
**Version:** 1.0  
**Status:** Production Ready ✅
